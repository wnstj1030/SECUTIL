# **Assembly**

ì–´ì…ˆë¸”ë¦¬ ì–¸ì–´ëŠ” ë¬¸ìž¥ìœ¼ë¡œ ì¹˜ìžë©´ ë™ì‚¬ì¸ ëª…ë ¹ì–´ì™€ ëª©ì ì–´ì— í•´ë‹¹í•˜ëŠ” í”¼ì—°ì‚°ìžë¡œ êµ¬ì„±ëœë‹¤

| ë°ì´í„° ì´ë™(Data Transfer) | mov,Â lea |
| --- | --- |
| ì‚°ìˆ  ì—°ì‚°(Arithmetic) | inc,Â dec,Â add,Â sub |
| ë…¼ë¦¬ ì—°ì‚°(Logical) | and,Â or,Â xor,Â not |
| ë¹„êµ(Comparison) | cmp,Â test |
| ë¶„ê¸°(Branch) | jmp,Â je,Â jg |
| ìŠ¤íƒ(Stack) | push,Â pop |
| í”„ë¡œì‹œì ¸(Procedure) | call,Â ret,Â leave |
| ì‹œìŠ¤í…œ ì½œ(System call) | syscall |

### í”¼ì—°ì‚°ìž

- ìƒìˆ˜(Immediate Value)
- ë ˆì§€ìŠ¤í„°(Register)
- ë©”ëª¨ë¦¬(Memory)

ë©”ëª¨ë¦¬ í”¼ì—°ì‚°ìžëŠ” []ì— ë‘˜ëŸ¬ì‹¸ì¸ ê²ƒìœ¼ë¡œ í‘œí˜„ë˜ë©°, ì•žì— í¬ê¸° ì§€ì •ìž `TYPE PTR` ì´ ì¶”ê°€ë  ìˆ˜ ìžˆë‹¤ 

ì—¬ê¸°ì„œ íƒ€ìž…ìœ¼ë¡œëŠ” BYTE, WORD, DWORD, QWORDê°€ ì˜¬ ìˆ˜ ìžˆê³  ê°ê° 1ë°”ì´íŠ¸, 2ë°”ì´íŠ¸, 4ë°”ì´íŠ¸, 8ë°”ì´íŠ¸ì˜ í¬ê¸°ë¥¼ ì§€ì •í•œë‹¤

EX)

| ë©”ëª¨ë¦¬ í”¼ì—°ì‚°ìž |  |
| --- | --- |
| QWORD PTR [0x8048000] | 0x8048000ì˜ ë°ì´í„°ë¥¼ 8ë°”ì´íŠ¸ë§Œí¼ ì°¸ì¡° |
| DWORD PTR [0x8048000] | 0x8048000ì˜ ë°ì´í„°ë¥¼ 4ë°”ì´íŠ¸ë§Œí¼ ì°¸ì¡° |
| WORD PTR [rax] | raxê°€ ê°€ë¥´í‚¤ëŠ” ì£¼ì†Œì—ì„œ ë°ì´í„°ë¥¼ 2ë°”ì´íŠ¸ ë§Œí¼ ì°¸ì¡° |

---

## ****x86-64 ì–´ì…ˆë¸”ë¦¬ ëª…ë ¹ì–´****

### ë°ì´í„° ì´ë™ðŸšš

ë°ì´í„° ì´ë™ ëª…ë ¹ì–´ëŠ” ì–´ë–¤ ê°’ì„ ë ˆì§€ìŠ¤í„°ë‚˜ ë©”ì˜¤ë¦¬ì— ì˜®ê¸°ë„ë¡ ì§€ì‹œí•œë‹¤

| mov dst, src :Â srcì— ë“¤ì–´ìžˆëŠ” ê°’ì„Â dstì— ëŒ€ìž… |  |
| --- | --- |
| mov rdi, rsi | rsiì˜ ê°’ì„ rdiì— ëŒ€ìž… |
| mov QWORD PTR[rdi], rsi | rsiì˜ ê°’ì„ rdiê°€ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œì— ëŒ€ìž… |
| mov QWORD PTR[rdi+8*rcx], rsi | rsiì˜ ê°’ì„ rdi+8*rcxê°€ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œì— ëŒ€ìž… |

**lea dst, src :Â srcì˜ ìœ íš¨ ì£¼ì†Œ(Effective Address, EA)ë¥¼ dstì— ì €ìž¥í•œë‹¤**

| lea rsi, [rbx+8*rcx] | rbx+8*rcx ë¥¼ rsiì— ëŒ€ìž… |
| --- | --- |

```c
[Register]
rbx = 0x401A40
=================================
[Memory]
0x401a40 | 0x0000000012345678
0x401a48 | 0x0000000000C0FFEE
0x401a50 | 0x00000000DEADBEEF
0x401a58 | 0x00000000CAFEBABE
0x401a60 | 0x0000000087654321
=================================
[Code]
1: mov rax, [rbx+8]
2: lea rax, [rbx+8]
```

Codeë¥¼ 1ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ëœ ê°’ì€?

â‡’ 0xC0FFEE

Codeë¥¼ 2ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ë“¤ì–´ìžˆëŠ” ê°’ì€?

â‡’ 0x401a48

### ì‚°ìˆ  ì—°ì‚°ðŸŽ²

**add dst, src : dstì— srcì˜ ê°’ì„ ë”í•œë‹¤**

| add eax, 3 | eax += 3 |
| --- | --- |
| add ax, WORD PTR[rdi] | ax += *(WORD *)rdi |

**sub dst, src: dstì—ì„œ srcì˜ ê°’ì„ ëº€ë‹¤**

| sub eax, 3 | eax -= 3 |
| --- | --- |
| sub ax, WORD PTR[rdi] | ax -= *(WORD *)rdi |

**inc op: opì˜ ê°’ì„ 1 ì¦ê°€ì‹œí‚¨ë‹¤**

| inc eax | eax += 1 |
| --- | --- |

**dec op: opì˜ ê°’ì„ 1 ê°ì†Œ ì‹œí‚¨ë‹¤**

| dec eax | eax -= 1 |
| --- | --- |

```c
[Register]
rax = 0x31337
rbx = 0x555555554000
rcx = 0x2
=================================
[Memory]
0x555555554000| 0x0000000000000000
0x555555554008| 0x0000000000000001
0x555555554010| 0x0000000000000003
0x555555554018| 0x0000000000000005
0x555555554020| 0x000000000003133A
==================================
[Code]
1: add rax, [rbx+rcx*8]
2: add rcx, 2
3: sub rax, [rbx+rcx*8]
4: inc rax
```

Codeë¥¼ 1ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ëœ ê°’ì€?

â‡’ 0x3133A

Codeë¥¼ 3ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ëœ ê°’ì€?

â‡’ 0

Codeë¥¼ 4ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ëœ ê°’ì€?

â‡’ 1

### ****ë…¼ë¦¬ ì—°ì‚°ðŸ¤” - and & or****

**and dst, src: dstì™€ srcì˜ ë¹„íŠ¸ê°€ ëª¨ë‘ 1ì´ë©´ 1, ì•„ë‹ˆë©´ 0**

```c
[Register]
eax = 0xffff0000
ebx = 0xcafebabe
[Code]
and eax, ebx
[Result]
eax = 0xcafe0000
```

**or dst, src: dstì™€ srcì˜ ë¹„íŠ¸ ì¤‘ í•˜ë‚˜ë¼ë„ 1ì´ë©´ 1, ì•„ë‹ˆë©´ 0**

```c
[Register]
eax = 0xffff0000
ebx = 0xcafebabe
[Code]
or eax, ebx
[Result]
eax = 0xffffbabe
```

****ì˜ˆì œðŸ“ë…¼ë¦¬ ì—°ì‚° - and, or****

```c
[Register]
rax = 0xffffffff00000000
rbx = 0x00000000ffffffff
rcx = 0x123456789abcdef0
==================================
[Code]
1: and rax, rcx
2: and rbx, rcx
3: or rax, rbx
```

Codeë¥¼ 1ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ëœ ê°’ì€?

â‡’ 0x1234567800000000

Codeë¥¼ 2ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rbx`ì— ì €ìž¥ëœ ê°’ì€?

â‡’ 0x000000009abcdef0

Codeë¥¼ 3ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ëœ ê°’ì€?

â‡’ 0x123456789abcdef0

### ****ë…¼ë¦¬ì—°ì‚°ðŸ¤” - xor & not****

**xor dst, src: dstì™€ srcì˜ ë¹„íŠ¸ê°€ ì„œë¡œ ë‹¤ë¥´ë©´ 1, ê°™ìœ¼ë©´ 0**

```c
[Register]
eax = 0xffffffff
ebx = 0xcafebabe
[Code]
xor eax, ebx
[Result]
eax = 0x35014541
```

**not op: opì˜ ë¹„íŠ¸ ì „ë¶€ ë°˜ì „**

```c
[Register]
eax = 0xffffffff
[Code]
not eax
[Result]
eax = 0x00000000
```

****ì˜ˆì œðŸ“ë…¼ë¦¬ ì—°ì‚° - xor, not****

```c
[Register]
rax = 0x35014541
rbx = 0xdeadbeef
==================================
[Code]
1: xor rax, rbx
2: xor rax, rbx
3: not eax
```

Codeë¥¼ 1ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ë˜ëŠ” ê°’ì€?

â‡’ 0xebacfbae

Codeë¥¼ 2ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ë˜ëŠ” ê°’ì€?

â‡’ 0x35014541

â‡’ xorì—°ì‚°ì„ ë™ì¼í•œ ê°’ìœ¼ë¡œ ë‘ ë²ˆ ì‹¤í–‰í•  ê²½ìš°, ì›ëž˜ ê°’ìœ¼ë¡œ ëŒì•„ê°„ë‹¤

Codeë¥¼ 3ê¹Œì§€ ì‹¤í–‰í–ˆì„ ë•Œ,Â `rax`ì— ì €ìž¥ë˜ëŠ” ê°’ì€?

â‡’ 0xcafebabe

â‡’ ì°¸ê³ ë¡œ [Code]ì˜ 3ë²ˆì—ì„œ raxê°€ ì•„ë‹Œ eaxë¥¼ not í•˜ì—¬ë„ ê´œì°®ì€ ì´ìœ ëŠ” eaxê°€ raxì˜ í•˜ìœ„ 32ë¹„íŠ¸ë¥¼ ê°€ë¦¬í‚¤ëŠ” ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì´ë‹¤

### ****ë¹„êµâš–ï¸****

**cmp op1, op2: op1ê³¼ op2ë¥¼ ë¹„êµ**

cmpëŠ” ë‘ í”¼ì—°ì‚°ìžë¥¼ ë¹¼ì„œ ëŒ€ì†Œë¥¼ ë¹„êµí•©ë‹ˆë‹¤. ì—°ì‚°ì˜ ê²°ê³¼ëŠ” op1ì— ëŒ€ìž…í•˜ì§€ ì•ŠëŠ”ë‹¤

```c
[Code]
1: mov rax, 0xA
2: mov rbx, 0xA
3: cmp rax, rbx ; ZF=1
```

**test op1, op2: op1ê³¼ op2ë¥¼ ë¹„êµ**

```c
[Code]
1: xor rax, rax
2: test rax, rax ; ZF=1
```

### ë¶„ê¸°****ðŸ”€****

**jmp addr: addrë¡œ ripë¥¼ ì´ë™**

```c
[Code]
1: xor rax, rax
2: jmp 1 ; jump to 1
```

**je addr: ì§ì „ì— ë¹„êµí•œ ë‘ í”¼ì—°ì‚°ìžê°€ ê°™ìœ¼ë©´ ì í”„ (jump if equal)**

```c
[Code]
1: mov rax, 0xcafebabe
2: mov rbx, 0xcafebabe
3: cmp rax, rbx ; rax == rbx
4: je 1 ; jump to 1
```

**jg addr: ì§ì „ì— ë¹„êµí•œ ë‘ ì—°ì‚°ìž ì¤‘ ì „ìžê°€ ë” í¬ë©´ ì í”„ (jump if greater)**
```c
[Code]
1: mov rax, 0x31337
2: mov rbx, 0x13337
3: cmp rax, rbx ; rax > rbx
4: jg 1  ; jump to 1
```